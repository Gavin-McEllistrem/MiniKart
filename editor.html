<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Map Editor - Mini Kart 3D</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="ui">
    <div id="group-id">Map Editor - Mini Kart 3D</div>
    <button id="render-mode-btn" class="mode-toggle-btn">ğŸ¨ Prototype Mode</button>
  </div>

  <div id="hud"></div>

  <!-- Map Editor UI -->
  <div id="editor-ui">
    <div id="editor-toolbar">
      <h3>Map Editor</h3>

      <!-- Tile Palette -->
      <div id="tile-palette">
        <h4>Tiles</h4>
        <div id="tile-grid">
          <!-- Tiles will be populated by JS -->
        </div>
      </div>

      <!-- Mode Selection -->
      <div id="mode-selection">
        <h4>Mode</h4>
        <button id="mode-tiles-btn" class="editor-btn mode-btn active">
          ğŸ§± Tiles
        </button>
        <button id="mode-checkpoints-btn" class="editor-btn mode-btn">
          ğŸ Checkpoints
        </button>
        <button id="mode-waypoints-btn" class="editor-btn mode-btn">
          ğŸ“ Waypoints
        </button>
        <button id="mode-decorations-btn" class="editor-btn mode-btn">
          ğŸŒ² Decorations
        </button>
      </div>

      <!-- Editor Controls -->
      <div id="editor-controls">
        <h4>Tools</h4>
        <div class="button-row">
          <label for="brush-size-slider">Brush Size: <span id="brush-size-value">1</span></label>
          <input type="range" id="brush-size-slider" min="1" max="5" value="1" step="1">
        </div>
        <div class="button-row">
          <label>
            <input type="checkbox" id="auto-tile-toggle" checked>
            Auto-Tile
          </label>
        </div>
        <button id="rotate-btn" class="editor-btn" title="Rotate tile (R)">
          ğŸ”„ Rotate
        </button>
        <button id="undo-btn" class="editor-btn" title="Undo (Ctrl+Z)">
          â†¶ Undo
        </button>
        <button id="redo-btn" class="editor-btn" title="Redo (Ctrl+Y)">
          â†· Redo
        </button>
        <button id="clear-btn" class="editor-btn warning" title="Clear entire track">
          ğŸ—‘ï¸ Clear
        </button>
      </div>

      <!-- Checkpoint Controls (shown in checkpoint mode) -->
      <div id="checkpoint-controls" class="hidden">
        <h4>Checkpoint Tools</h4>
        <div class="info-box">
          Click and drag to draw a checkpoint line
        </div>
        <button id="toggle-finish-line-btn" class="editor-btn">
          Make Next Finish Line
        </button>
        <button id="clear-checkpoints-btn" class="editor-btn warning">
          Clear All Checkpoints
        </button>
        <div id="checkpoint-list">
          <h5>Checkpoints</h5>
          <div id="checkpoint-items">
            <!-- Checkpoints will be listed here -->
          </div>
        </div>
      </div>

      <!-- Waypoint Controls (shown in waypoint mode) -->
      <div id="waypoint-controls" class="hidden">
        <h4>Waypoint Tools</h4>
        <div class="info-box">
          Click to place waypoints in order. AI will follow the path created.
        </div>
        <button id="clear-waypoints-btn" class="editor-btn warning">
          Clear All Waypoints
        </button>
        <button id="visualize-field-btn" class="editor-btn">
          ğŸ‘ï¸ Visualize Direction Field
        </button>
        <div id="waypoint-list">
          <h5>Waypoints (<span id="waypoint-count">0</span>)</h5>
          <div id="waypoint-items">
            <!-- Waypoints will be listed here -->
          </div>
        </div>
      </div>

      <!-- Decoration Controls (shown in decoration mode) -->
      <div id="decoration-controls" class="hidden">
        <h4>Object Palette</h4>
        <div id="object-grid">
          <!-- Objects will be populated by JS -->
        </div>
        <h4>Transform Tools</h4>
        <div class="info-box">
          Click to place selected object
        </div>
        <div class="button-row">
          <button id="rotate-object-left-btn" class="editor-btn" title="Rotate 45Â° left">
            â†¶ Rotate
          </button>
          <button id="rotate-object-right-btn" class="editor-btn" title="Rotate 45Â° right">
            â†· Rotate
          </button>
        </div>
        <div class="button-row">
          <button id="scale-down-btn" class="editor-btn" title="Scale down 20%">
            ğŸ”½ Scale -
          </button>
          <button id="scale-up-btn" class="editor-btn" title="Scale up 20%">
            ğŸ”¼ Scale +
          </button>
        </div>
        <button id="clear-objects-btn" class="editor-btn warning">
          Clear All Objects
        </button>
        <div id="object-list">
          <h5>Placed Objects</h5>
          <div id="object-items">
            <!-- Objects will be listed here -->
          </div>
        </div>
      </div>

      <!-- Track Management -->
      <div id="track-controls">
        <h4>Track</h4>
        <input type="text" id="track-name" placeholder="Track Name" value="My Track" />
        <button id="test-btn" class="editor-btn primary">â–¶ï¸ Test Track</button>
        <button id="save-btn" class="editor-btn">ğŸ’¾ Save</button>
        <button id="load-btn" class="editor-btn">ğŸ“‚ Load Saved</button>
        <button id="import-btn" class="editor-btn">ğŸ“¤ Import JSON</button>
        <input type="file" id="file-input" accept=".json" style="display: none;" />
        <button id="export-btn" class="editor-btn">ğŸ“¥ Export JSON</button>
      </div>

      <!-- Grid Info -->
      <div id="grid-info">
        <h4>Grid Info</h4>
        <div>Cursor: <span id="grid-coords">--</span></div>
        <div>Selected: <span id="selected-tile">None</span></div>
        <div>Rotation: <span id="rotation-display">0Â°</span></div>
        <div>Scale: <span id="scale-display">1.00x</span></div>
      </div>

      <!-- Mode Toggle -->
      <div id="mode-toggle">
        <button id="exit-editor-btn" class="editor-btn warning">
          âŒ Exit Editor
        </button>
      </div>
    </div>
  </div>

  <!-- Main Menu (hidden) -->
  <div id="main-menu" class="hidden"></div>

  <div id="touch-controls" class="hidden"></div>

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>
  <!-- Editor module script -->
  <script type="module" src="editor.js"></script>
</body>
</html>
